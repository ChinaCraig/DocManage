# å¾‹å¸ˆæ¡ˆä»¶æ¡ˆå®—æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ

åŸºäºŽFlaskçš„æ–‡æ¡£ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒè‡ªç„¶è¯­ä¹‰æ£€ç´¢å’Œå¤šç§æ–‡ä»¶æ ¼å¼å¤„ç†ã€‚

## åŠŸèƒ½ç‰¹æ€§

### æ–‡æ¡£ç®¡ç†
- âœ… å¯ç¼–è¾‘æ–‡æ¡£ç»“æž„æ ‘ï¼ˆæ–‡ä»¶å¤¹+æ–‡ä»¶ï¼‰
- âœ… æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼ä¸Šä¼ ï¼šPDFã€Wordã€Excelã€å›¾ç‰‡ã€è§†é¢‘
- âœ… æ–‡ä»¶å¤¹å±‚çº§ç®¡ç†ï¼Œåªæœ‰æ–‡ä»¶å¤¹å¯ä½œä¸ºçˆ¶èŠ‚ç‚¹
- âœ… å¯ç¼–è¾‘æ–‡æœ¬å†…å®¹å’Œæè¿°

### æ™ºèƒ½æ£€ç´¢
- âœ… è‡ªç„¶è¯­ä¹‰æ£€ç´¢ï¼ˆåŸºäºŽå‘é‡ç›¸ä¼¼åº¦ï¼‰
- âœ… æ–‡æ¡£åç§°æœç´¢
- âœ… PDFæ–‡æ¡£å†…å®¹æå–å’Œåˆ†å—å¤„ç†
- âœ… æ”¯æŒæ–‡æœ¬åž‹å’Œæ‰«æå›¾åƒåž‹PDF

### æŠ€æœ¯æž¶æž„
- **åŽç«¯**: Python Flask + SQLAlchemy
- **æ•°æ®åº“**: MySQL 
- **å‘é‡æ•°æ®åº“**: Milvus
- **æ–‡æ¡£å¤„ç†**: PyMuPDF, pdfplumber, pytesseract
- **æ–‡æœ¬åµŒå…¥**: sentence-transformers
- **å‰ç«¯**: Bootstrap 5 + Vanilla JavaScript

## å®‰è£…éƒ¨ç½²

### 1. çŽ¯å¢ƒè¦æ±‚
- Python 3.8+
- MySQL 5.7+
- Milvus 2.0+
- Tesseract OCR

### 2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 3. é…ç½®çŽ¯å¢ƒå˜é‡
å¤åˆ¶ `env_example.txt` ä¸º `.env` å¹¶ä¿®æ”¹é…ç½®ï¼š
```bash
cp env_example.txt .env
```

### 4. æ•°æ®åº“åˆå§‹åŒ–

**é‡è¦**: éœ€è¦æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“å’Œè¡¨ç»“æž„ï¼Œä¸ä¾èµ–ä»£ç è‡ªåŠ¨åˆ›å»ºã€‚

#### æ–¹æ³•ä¸€ï¼šå‘½ä»¤è¡Œæ‰§è¡Œ
```bash
# 1. è¿žæŽ¥MySQLå¹¶åˆ›å»ºæ•°æ®åº“
mysql -h 192.168.16.108 -u root -p
mysql> CREATE DATABASE document_management CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
mysql> exit;

# 2. æ‰§è¡Œå»ºè¡¨è„šæœ¬
mysql -h 192.168.16.108 -u root -p document_management < database/create_tables.sql
```

#### æ–¹æ³•äºŒï¼šç›´æŽ¥å¯¼å…¥
```bash
# åˆ›å»ºæ•°æ®åº“å¹¶å¯¼å…¥è¡¨ç»“æž„ï¼ˆä¸€æ¡å‘½ä»¤ï¼‰
mysql -h 192.168.16.108 -u root -p -e "CREATE DATABASE IF NOT EXISTS document_management CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
mysql -h 192.168.16.108 -u root -p document_management < database/create_tables.sql
```

è¯¦ç»†çš„æ•°æ®åº“è®¾ç½®è¯´æ˜Žè¯·å‚è€ƒ [DATABASE_SETUP.md](DATABASE_SETUP.md)

### 5. å¯åŠ¨æœåŠ¡
```bash
python run.py
```

è®¿é—® http://localhost:5001

## ç³»ç»Ÿæž¶æž„

### ç›®å½•ç»“æž„
```
DocManage2/
â”œâ”€â”€ app/                          # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ __init__.py              # Flaskåº”ç”¨å·¥åŽ‚
â”‚   â”œâ”€â”€ models/                  # æ•°æ®æ¨¡åž‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ document_models.py   # æ–‡æ¡£ç›¸å…³æ¨¡åž‹
â”‚   â”œâ”€â”€ services/                # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ pdf_service.py       # PDFå¤„ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ word_service.py      # Wordå¤„ç†æœåŠ¡ï¼ˆå¾…å®žçŽ°ï¼‰
â”‚   â”‚   â”œâ”€â”€ excel_service.py     # Excelå¤„ç†æœåŠ¡ï¼ˆå¾…å®žçŽ°ï¼‰
â”‚   â”‚   â”œâ”€â”€ image_service.py     # å›¾ç‰‡å¤„ç†æœåŠ¡ï¼ˆå¾…å®žçŽ°ï¼‰
â”‚   â”‚   â”œâ”€â”€ video_service.py     # è§†é¢‘å¤„ç†æœåŠ¡ï¼ˆå¾…å®žçŽ°ï¼‰
â”‚   â”‚   â””â”€â”€ vector_service.py    # å‘é‡åŒ–æœåŠ¡
â”‚   â”œâ”€â”€ routes/                  # è·¯ç”±æŽ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ document_routes.py   # æ–‡æ¡£ç®¡ç†è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ upload_routes.py     # æ–‡ä»¶ä¸Šä¼ è·¯ç”±
â”‚   â”‚   â””â”€â”€ search_routes.py     # æœç´¢è·¯ç”±
â”‚   â””â”€â”€ static/                  # é™æ€æ–‡ä»¶
â”‚       â”œâ”€â”€ index.html           # ä¸»é¡µé¢
â”‚       â””â”€â”€ js/
â”‚           â””â”€â”€ app.js           # å‰ç«¯JavaScript
â”œâ”€â”€ database/
â”‚   â””â”€â”€ create_tables.sql        # æ•°æ®åº“å»ºè¡¨è„šæœ¬
â”œâ”€â”€ DATABASE_SETUP.md            # æ•°æ®åº“è®¾ç½®æŒ‡å—
â”œâ”€â”€ config.py                    # é…ç½®æ–‡ä»¶
â”œâ”€â”€ run.py                       # å¯åŠ¨æ–‡ä»¶
â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–
â”œâ”€â”€ env_example.txt              # çŽ¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜Ž
```

### æ•°æ®åº“è®¾è®¡

#### ä¸»è¦è¡¨ç»“æž„
1. **document_nodes** - æ–‡æ¡£èŠ‚ç‚¹è¡¨ï¼ˆç»Ÿä¸€ç®¡ç†æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼‰
2. **document_contents** - æ–‡æ¡£å†…å®¹è¡¨ï¼ˆå­˜å‚¨æå–çš„æ–‡æœ¬å†…å®¹å’Œåˆ†å—ï¼‰
3. **vector_records** - å‘é‡åŒ–è®°å½•è¡¨ï¼ˆè®°å½•å‘é‡åŒ–çŠ¶æ€å’ŒMilvuså‘é‡IDï¼‰
4. **system_configs** - ç³»ç»Ÿé…ç½®è¡¨ï¼ˆåŠ¨æ€é…ç½®å‚æ•°ï¼‰

**æ³¨æ„**: ç³»ç»Ÿå¯åŠ¨æ—¶ä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¡¨ï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œå»ºè¡¨è„šæœ¬ã€‚

### æœåŠ¡æ¨¡å—è®¾è®¡

#### æ–‡ä»¶å¤„ç†æœåŠ¡
- **PDFService**: PDFæ–‡æ¡£å¤„ç†ï¼ˆâœ… å·²å®žçŽ°ï¼‰
  - æ–‡æœ¬åž‹PDFç›´æŽ¥æå–
  - å›¾åƒåž‹PDFä½¿ç”¨OCRè¯†åˆ«
  - æ™ºèƒ½åˆ†å—å’Œå‘é‡åŒ–
- **WordService**: Wordæ–‡æ¡£å¤„ç†ï¼ˆðŸ”„ å¾…å®žçŽ°ï¼‰
- **ExcelService**: Excelæ–‡æ¡£å¤„ç†ï¼ˆðŸ”„ å¾…å®žçŽ°ï¼‰
- **ImageService**: å›¾ç‰‡å¤„ç†ï¼ˆðŸ”„ å¾…å®žçŽ°ï¼‰
- **VideoService**: è§†é¢‘å¤„ç†ï¼ˆðŸ”„ å¾…å®žçŽ°ï¼‰

#### å‘é‡åŒ–æœåŠ¡
- **VectorService**: å‘é‡æ•°æ®åº“æ“ä½œ
  - åŸºäºŽsentence-transformersçš„æ–‡æœ¬åµŒå…¥
  - Milvuså‘é‡å­˜å‚¨å’Œæ£€ç´¢
  - ç›¸ä¼¼åº¦æœç´¢

## APIæŽ¥å£

### æ–‡æ¡£ç®¡ç†
- `GET /api/documents/` - èŽ·å–æ–‡æ¡£åˆ—è¡¨
- `GET /api/documents/tree` - èŽ·å–æ–‡æ¡£æ ‘
- `POST /api/documents/folder` - åˆ›å»ºæ–‡ä»¶å¤¹
- `PUT /api/documents/{id}` - æ›´æ–°æ–‡æ¡£ä¿¡æ¯
- `DELETE /api/documents/{id}` - åˆ é™¤æ–‡æ¡£
- `GET /api/documents/{id}/detail` - èŽ·å–æ–‡æ¡£è¯¦æƒ…

### æ–‡ä»¶ä¸Šä¼ 
- `POST /api/upload/` - ä¸Šä¼ æ–‡ä»¶
- `POST /api/upload/process/{id}` - å¤„ç†æ–‡æ¡£å†…å®¹
- `POST /api/upload/vectorize/{id}` - å‘é‡åŒ–æ–‡æ¡£

### æœç´¢åŠŸèƒ½
- `POST /api/search/` - è¯­ä¹‰æœç´¢
- `GET /api/search/documents` - æ–‡æ¡£åç§°æœç´¢
- `GET /api/search/suggest` - æœç´¢å»ºè®®
- `GET /api/search/stats` - æœç´¢ç»Ÿè®¡

## é…ç½®è¯´æ˜Ž

### æ¨¡åž‹é…ç½®
ç³»ç»Ÿä½¿ç”¨åŠ¨æ€é…ç½®ï¼Œå¯åœ¨ `system_configs` è¡¨ä¸­ä¿®æ”¹ï¼š
- `embedding_model`: æ–‡æœ¬åµŒå…¥æ¨¡åž‹è·¯å¾„
- `chunk_size`: æ–‡æœ¬åˆ†å—å¤§å°
- `chunk_overlap`: åˆ†å—é‡å å¤§å°
- `milvus_host`: MilvusæœåŠ¡å™¨åœ°å€
- `milvus_port`: MilvusæœåŠ¡å™¨ç«¯å£

### æ–‡ä»¶å­˜å‚¨
- æœ¬åœ°æ–‡ä»¶å­˜å‚¨ï¼Œè·¯å¾„å¯é…ç½®
- æ–‡ä»¶é‡å‘½åä¸ºUUIDé¿å…å†²çª
- æ”¯æŒçš„æ–‡ä»¶ç±»åž‹å¯æ‰©å±•

## æ‰©å±•è¯´æ˜Ž

### æ·»åŠ æ–°æ–‡ä»¶ç±»åž‹æ”¯æŒ
1. åœ¨ `upload_routes.py` ä¸­æ·»åŠ æ–‡ä»¶æ‰©å±•åæ˜ å°„
2. åˆ›å»ºå¯¹åº”çš„Serviceç±»
3. å®žçŽ° `extract_text_content` å’Œ `split_into_chunks` æ–¹æ³•

### è‡ªå®šä¹‰åµŒå…¥æ¨¡åž‹
1. ä¿®æ”¹ `system_configs` è¡¨ä¸­çš„ `embedding_model` é…ç½®
2. ç¡®ä¿æ¨¡åž‹å…¼å®¹ sentence-transformers æŽ¥å£

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“åˆå§‹åŒ–**: å¿…é¡»æ‰‹åŠ¨æ‰§è¡Œå»ºè¡¨è„šæœ¬ï¼Œç³»ç»Ÿä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“
2. **æ•°æ®åº“è¿žæŽ¥**: ç¡®ä¿MySQLæœåŠ¡å™¨å¯è®¿é—®ï¼Œé…ç½®æ­£ç¡®çš„è¿žæŽ¥å‚æ•°
3. **MilvusæœåŠ¡**: éœ€è¦å…ˆå¯åŠ¨Milvuså‘é‡æ•°æ®åº“
4. **OCRä¾èµ–**: å¤„ç†æ‰«æPDFéœ€è¦å®‰è£…Tesseract OCR
5. **æ¨¡åž‹ä¸‹è½½**: é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½åµŒå…¥æ¨¡åž‹ï¼Œéœ€è¦ç½‘ç»œè¿žæŽ¥
6. **æ–‡ä»¶æƒé™**: ç¡®ä¿æ–‡ä»¶å­˜å‚¨ç›®å½•æœ‰å†™å…¥æƒé™

## åŽç»­ä¼˜åŒ–

- [ ] å®žçŽ°Wordã€Excelã€å›¾ç‰‡ã€è§†é¢‘æ–‡ä»¶å¤„ç†
- [ ] æ·»åŠ ç”¨æˆ·æƒé™ç®¡ç†
- [ ] ä¼˜åŒ–å‰ç«¯UIäº¤äº’
- [ ] æ”¯æŒæ‰¹é‡æ–‡ä»¶ä¸Šä¼ 
- [ ] æ·»åŠ æ–‡æ¡£é¢„è§ˆåŠŸèƒ½
- [ ] å®žçŽ°æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†
- [ ] æ”¯æŒå…¨æ–‡æ£€ç´¢
- [ ] æ·»åŠ APIæ–‡æ¡£ï¼ˆSwaggerï¼‰

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `app.log` èŽ·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚ 